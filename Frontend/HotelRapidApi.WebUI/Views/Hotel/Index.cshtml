@using HotelRapidApi.WebUI.Models
@model HotelListViewModel

@{
    ViewData["Title"] = "Tüm Oteller";
    Layout = "~/Views/Shared/_UILayout.cshtml";
}

<!-- PAGE HEADER -->
<div class="container-fluid page-header mb-5 p-0"
     style="background-image: url('/hotel-theme/img/carousel-1.jpg');">
    <div class="container-fluid page-header-inner py-5">
        <div class="container text-center">
            <h1 class="display-3 text-white mb-3">Tüm Oteller</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb justify-content-center text-uppercase">
                    <li class="breadcrumb-item">
                        <a asp-controller="Default" asp-action="Index">Ana Sayfa</a>
                    </li>
                    <li class="breadcrumb-item active text-white" aria-current="page">
                        Otel Listesi
                    </li>
                </ol>
            </nav>
        </div>
    </div>
</div>

<div class="container-xxl py-5">
    <div class="container">
        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
            <h6 class="section-title text-center text-primary text-uppercase">RapidAPI Otelleri</h6>
            <h1 class="mb-5">Filtrelenebilir <span class="text-primary text-uppercase">Otel Listesi</span></h1>
            <p class="text-muted">
                Bu sayfada en fazla 50 otel listelenir ve her sayfada 10 otel gösterilir.
            </p>
        </div>

        <div class="row g-4 mb-4">
            <div class="col-lg-12">
                <div class="bg-light rounded p-4 shadow-sm">
                    <h5 class="mb-3 text-primary">Detaylı Filtreleme</h5>
                    <form method="get" class="row g-3">
                        <div class="col-lg-4 col-md-6">
                            <label class="form-label">Otel Adı</label>
                            <input type="text" class="form-control" name="searchTerm" value="@Model.SearchTerm" placeholder="Örn: Palace, Resort..." />
                        </div>
                        <div class="col-lg-2 col-md-3">
                            <label class="form-label">Min Puan</label>
                            <input type="number" step="0.1" min="0" max="10" class="form-control" name="minScore" value="@Model.MinScore" />
                        </div>
                        <div class="col-lg-2 col-md-3">
                            <label class="form-label">Max Puan</label>
                            <input type="number" step="0.1" min="0" max="10" class="form-control" name="maxScore" value="@Model.MaxScore" />
                        </div>
                        <div class="col-lg-2 col-md-3">
                            <label class="form-label">Min Yorum</label>
                            <input type="number" min="0" class="form-control" name="minReviewCount" value="@Model.MinReviewCount" />
                        </div>
                        <div class="col-lg-2 col-md-3">
                            <label class="form-label">Max Yorum</label>
                            <input type="number" min="0" class="form-control" name="maxReviewCount" value="@Model.MaxReviewCount" />
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label">Para Birimi</label>
                            <select class="form-select" name="currency">
                                <option value="">Tümü</option>
                                @foreach (var currency in Model.AvailableCurrencies)
                                {
                                    <option value="@currency" selected="@(currency == Model.Currency)">
                                        @currency
                                    </option>
                                }
                            </select>

                        </div>
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label">Giriş Tarihi (en erken)</label>
                            <input type="date" class="form-control" name="checkinFrom" value="@(Model.CheckinFrom?.ToString("yyyy-MM-dd"))" />
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label">Çıkış Tarihi (en geç)</label>
                            <input type="date" class="form-control" name="checkoutTo" value="@(Model.CheckoutTo?.ToString("yyyy-MM-dd"))" />
                        </div>
                        <div class="col-lg-3 col-md-6 d-flex align-items-end gap-2">
                            <button type="submit" class="btn btn-primary w-100">Filtrele</button>
                            <a asp-controller="Hotel" asp-action="Index" class="btn btn-outline-secondary w-100">Temizle</a>
                        </div>
                    </form>
                    <div class="mt-3 text-muted">
                        Toplam sonuç: <strong>@Model.TotalCount</strong>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            @if (Model.Hotels != null && Model.Hotels.Any())
            {
                foreach (var hotel in Model.Hotels)
                {
                    var imageUrl = !string.IsNullOrEmpty(hotel.ImageUrl)
                        ? hotel.ImageUrl
                        : "https://placehold.co/600x400?text=Hotel";

                    <div class="col-lg-4 col-md-6">
                        <div class="room-item shadow rounded overflow-hidden h-100">
                            <div class="position-relative">
                                <a asp-controller="Hotel" asp-action="Detail" asp-route-id="@hotel.HotelId">
                                    <img class="img-fluid" src="@imageUrl" alt="@hotel.Name" />
                                </a>
                                <small class="position-absolute start-0 top-100 translate-middle-y
                                               bg-primary text-white rounded py-1 px-3 ms-4">
                                    @hotel.ReviewScore.ToString("0.0") @hotel.ReviewScoreWord
                                </small>
                            </div>
                            <div class="p-4 mt-2 d-flex flex-column h-100">
                                <div class="mb-2">
                                    <h5 class="mb-0">
                                        <a asp-controller="Hotel" asp-action="Detail" asp-route-id="@hotel.HotelId"
                                           class="text-dark text-decoration-none">
                                            @hotel.Name
                                        </a>
                                    </h5>
                                </div>
                                <p class="text-body mb-3">
                                    Konaklama tarihleri:<br />
                                    @hotel.CheckinDate - @hotel.CheckoutDate
                                </p>
                                <div class="d-flex justify-content-between mb-3">
                                    <span class="text-primary">
                                        @hotel.ReviewCount yorum
                                    </span>
                                    <span class="text-muted">
                                        @hotel.PriceText
                                    </span>
                                </div>
                                <div class="mt-auto text-end position-relative" style="z-index: 5;">
                                    <a asp-controller="Hotel" asp-action="Detail" asp-route-id="@hotel.HotelId"
                                       class="btn btn-outline-primary btn-sm">
                                        Detayları Gör
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="alert alert-warning text-center mb-0">
                        Seçilen filtrelerle eşleşen otel bulunamadı.
                    </div>
                </div>
            }
        </div>

        @if (Model.TotalPages > 1)
        {
            <div class="row mt-5">
                <div class="col-12">
                    <nav aria-label="Hotel pagination">
                        <ul class="pagination justify-content-center">
                            <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                                <a class="page-link"
                                   asp-action="Index"
                                   asp-route-page="@(Model.CurrentPage - 1)"
                                   asp-route-searchTerm="@Model.SearchTerm"
                                   asp-route-minScore="@Model.MinScore"
                                   asp-route-maxScore="@Model.MaxScore"
                                   asp-route-minReviewCount="@Model.MinReviewCount"
                                   asp-route-maxReviewCount="@Model.MaxReviewCount"
                                   asp-route-currency="@Model.Currency"
                                   asp-route-checkinFrom="@(Model.CheckinFrom?.ToString("yyyy-MM-dd"))"
                                   asp-route-checkoutTo="@(Model.CheckoutTo?.ToString("yyyy-MM-dd"))">
                                    Önceki
                                </a>
                            </li>
                            @for (var i = 1; i <= Model.TotalPages; i++)
                            {
                                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                    <a class="page-link"
                                       asp-action="Index"
                                       asp-route-page="@i"
                                       asp-route-searchTerm="@Model.SearchTerm"
                                       asp-route-minScore="@Model.MinScore"
                                       asp-route-maxScore="@Model.MaxScore"
                                       asp-route-minReviewCount="@Model.MinReviewCount"
                                       asp-route-maxReviewCount="@Model.MaxReviewCount"
                                       asp-route-currency="@Model.Currency"
                                       asp-route-checkinFrom="@(Model.CheckinFrom?.ToString("yyyy-MM-dd"))"
                                       asp-route-checkoutTo="@(Model.CheckoutTo?.ToString("yyyy-MM-dd"))">
                                        @i
                                    </a>
                                </li>
                            }
                            <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                                <a class="page-link"
                                   asp-action="Index"
                                   asp-route-page="@(Model.CurrentPage + 1)"
                                   asp-route-searchTerm="@Model.SearchTerm"
                                   asp-route-minScore="@Model.MinScore"
                                   asp-route-maxScore="@Model.MaxScore"
                                   asp-route-minReviewCount="@Model.MinReviewCount"
                                   asp-route-maxReviewCount="@Model.MaxReviewCount"
                                   asp-route-currency="@Model.Currency"
                                   asp-route-checkinFrom="@(Model.CheckinFrom?.ToString("yyyy-MM-dd"))"
                                   asp-route-checkoutTo="@(Model.CheckoutTo?.ToString("yyyy-MM-dd"))">
                                    Sonraki
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        }
    </div>
</div>
